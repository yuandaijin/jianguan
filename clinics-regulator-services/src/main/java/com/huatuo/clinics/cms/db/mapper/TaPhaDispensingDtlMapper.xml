<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.huatuo.clinics.cms.db.mapper.TaPhaDispensingDtlMapper" >
  <resultMap id="BaseResultMap" type="com.huatuo.clinics.cms.db.bean.TaPhaDispensingDtl" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    <id column="dispense_item_id" property="dispenseItemId" jdbcType="CHAR" />
    <result column="pha_drug_id" property="phaDrugId" jdbcType="CHAR" />
    <result column="dispense_id" property="dispenseId" jdbcType="CHAR" />
    <result column="ord_dtl_id" property="ordDtlId" jdbcType="CHAR" />
    <result column="drug_spec" property="drugSpec" jdbcType="VARCHAR" />
    <result column="trade_name" property="tradeName" jdbcType="VARCHAR" />
    <result column="manufacturer" property="manufacturer" jdbcType="VARCHAR" />
    <result column="instock_batch" property="instockBatch" jdbcType="VARCHAR" />
    <result column="org_id" property="orgId" jdbcType="CHAR" />
    <result column="order_id" property="orderId" jdbcType="CHAR" />
    <result column="charge_dtl_id" property="chargeDtlId" jdbcType="CHAR" />
    <result column="seriel" property="seriel" jdbcType="CHAR" />
    <result column="quantity" property="quantity" jdbcType="INTEGER" />
    <result column="buy_unit" property="buyUnit" jdbcType="VARCHAR" />
    <result column="origin_price" property="originPrice" jdbcType="REAL" />
    <result column="real_price" property="realPrice" jdbcType="REAL" />
  </resultMap>
  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    dispense_item_id, pha_drug_id, dispense_id, ord_dtl_id, drug_spec, trade_name, manufacturer, 
    instock_batch, org_id, order_id, charge_dtl_id, seriel, quantity, buy_unit, origin_price, 
    real_price
  </sql>
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.huatuo.clinics.cms.db.bean.TaPhaDispensingDtlExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from ta_pha_dispensing_dtl
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from ta_pha_dispensing_dtl
    where dispense_item_id = #{dispenseItemId,jdbcType=CHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    delete from ta_pha_dispensing_dtl
    where dispense_item_id = #{dispenseItemId,jdbcType=CHAR}
  </delete>
  <delete id="deleteByExample" parameterType="com.huatuo.clinics.cms.db.bean.TaPhaDispensingDtlExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    delete from ta_pha_dispensing_dtl
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.huatuo.clinics.cms.db.bean.TaPhaDispensingDtl" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    insert into ta_pha_dispensing_dtl (dispense_item_id, pha_drug_id, dispense_id, 
      ord_dtl_id, drug_spec, trade_name, 
      manufacturer, instock_batch, org_id, 
      order_id, charge_dtl_id, seriel, 
      quantity, buy_unit, origin_price, 
      real_price)
    values (#{dispenseItemId,jdbcType=CHAR}, #{phaDrugId,jdbcType=CHAR}, #{dispenseId,jdbcType=CHAR}, 
      #{ordDtlId,jdbcType=CHAR}, #{drugSpec,jdbcType=VARCHAR}, #{tradeName,jdbcType=VARCHAR}, 
      #{manufacturer,jdbcType=VARCHAR}, #{instockBatch,jdbcType=VARCHAR}, #{orgId,jdbcType=CHAR}, 
      #{orderId,jdbcType=CHAR}, #{chargeDtlId,jdbcType=CHAR}, #{seriel,jdbcType=CHAR}, 
      #{quantity,jdbcType=INTEGER}, #{buyUnit,jdbcType=VARCHAR}, #{originPrice,jdbcType=REAL}, 
      #{realPrice,jdbcType=REAL})
  </insert>
  <insert id="insertSelective" parameterType="com.huatuo.clinics.cms.db.bean.TaPhaDispensingDtl" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    insert into ta_pha_dispensing_dtl
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="dispenseItemId != null" >
        dispense_item_id,
      </if>
      <if test="phaDrugId != null" >
        pha_drug_id,
      </if>
      <if test="dispenseId != null" >
        dispense_id,
      </if>
      <if test="ordDtlId != null" >
        ord_dtl_id,
      </if>
      <if test="drugSpec != null" >
        drug_spec,
      </if>
      <if test="tradeName != null" >
        trade_name,
      </if>
      <if test="manufacturer != null" >
        manufacturer,
      </if>
      <if test="instockBatch != null" >
        instock_batch,
      </if>
      <if test="orgId != null" >
        org_id,
      </if>
      <if test="orderId != null" >
        order_id,
      </if>
      <if test="chargeDtlId != null" >
        charge_dtl_id,
      </if>
      <if test="seriel != null" >
        seriel,
      </if>
      <if test="quantity != null" >
        quantity,
      </if>
      <if test="buyUnit != null" >
        buy_unit,
      </if>
      <if test="originPrice != null" >
        origin_price,
      </if>
      <if test="realPrice != null" >
        real_price,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="dispenseItemId != null" >
        #{dispenseItemId,jdbcType=CHAR},
      </if>
      <if test="phaDrugId != null" >
        #{phaDrugId,jdbcType=CHAR},
      </if>
      <if test="dispenseId != null" >
        #{dispenseId,jdbcType=CHAR},
      </if>
      <if test="ordDtlId != null" >
        #{ordDtlId,jdbcType=CHAR},
      </if>
      <if test="drugSpec != null" >
        #{drugSpec,jdbcType=VARCHAR},
      </if>
      <if test="tradeName != null" >
        #{tradeName,jdbcType=VARCHAR},
      </if>
      <if test="manufacturer != null" >
        #{manufacturer,jdbcType=VARCHAR},
      </if>
      <if test="instockBatch != null" >
        #{instockBatch,jdbcType=VARCHAR},
      </if>
      <if test="orgId != null" >
        #{orgId,jdbcType=CHAR},
      </if>
      <if test="orderId != null" >
        #{orderId,jdbcType=CHAR},
      </if>
      <if test="chargeDtlId != null" >
        #{chargeDtlId,jdbcType=CHAR},
      </if>
      <if test="seriel != null" >
        #{seriel,jdbcType=CHAR},
      </if>
      <if test="quantity != null" >
        #{quantity,jdbcType=INTEGER},
      </if>
      <if test="buyUnit != null" >
        #{buyUnit,jdbcType=VARCHAR},
      </if>
      <if test="originPrice != null" >
        #{originPrice,jdbcType=REAL},
      </if>
      <if test="realPrice != null" >
        #{realPrice,jdbcType=REAL},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.huatuo.clinics.cms.db.bean.TaPhaDispensingDtlExample" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    select count(*) from ta_pha_dispensing_dtl
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    update ta_pha_dispensing_dtl
    <set >
      <if test="record.dispenseItemId != null" >
        dispense_item_id = #{record.dispenseItemId,jdbcType=CHAR},
      </if>
      <if test="record.phaDrugId != null" >
        pha_drug_id = #{record.phaDrugId,jdbcType=CHAR},
      </if>
      <if test="record.dispenseId != null" >
        dispense_id = #{record.dispenseId,jdbcType=CHAR},
      </if>
      <if test="record.ordDtlId != null" >
        ord_dtl_id = #{record.ordDtlId,jdbcType=CHAR},
      </if>
      <if test="record.drugSpec != null" >
        drug_spec = #{record.drugSpec,jdbcType=VARCHAR},
      </if>
      <if test="record.tradeName != null" >
        trade_name = #{record.tradeName,jdbcType=VARCHAR},
      </if>
      <if test="record.manufacturer != null" >
        manufacturer = #{record.manufacturer,jdbcType=VARCHAR},
      </if>
      <if test="record.instockBatch != null" >
        instock_batch = #{record.instockBatch,jdbcType=VARCHAR},
      </if>
      <if test="record.orgId != null" >
        org_id = #{record.orgId,jdbcType=CHAR},
      </if>
      <if test="record.orderId != null" >
        order_id = #{record.orderId,jdbcType=CHAR},
      </if>
      <if test="record.chargeDtlId != null" >
        charge_dtl_id = #{record.chargeDtlId,jdbcType=CHAR},
      </if>
      <if test="record.seriel != null" >
        seriel = #{record.seriel,jdbcType=CHAR},
      </if>
      <if test="record.quantity != null" >
        quantity = #{record.quantity,jdbcType=INTEGER},
      </if>
      <if test="record.buyUnit != null" >
        buy_unit = #{record.buyUnit,jdbcType=VARCHAR},
      </if>
      <if test="record.originPrice != null" >
        origin_price = #{record.originPrice,jdbcType=REAL},
      </if>
      <if test="record.realPrice != null" >
        real_price = #{record.realPrice,jdbcType=REAL},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    update ta_pha_dispensing_dtl
    set dispense_item_id = #{record.dispenseItemId,jdbcType=CHAR},
      pha_drug_id = #{record.phaDrugId,jdbcType=CHAR},
      dispense_id = #{record.dispenseId,jdbcType=CHAR},
      ord_dtl_id = #{record.ordDtlId,jdbcType=CHAR},
      drug_spec = #{record.drugSpec,jdbcType=VARCHAR},
      trade_name = #{record.tradeName,jdbcType=VARCHAR},
      manufacturer = #{record.manufacturer,jdbcType=VARCHAR},
      instock_batch = #{record.instockBatch,jdbcType=VARCHAR},
      org_id = #{record.orgId,jdbcType=CHAR},
      order_id = #{record.orderId,jdbcType=CHAR},
      charge_dtl_id = #{record.chargeDtlId,jdbcType=CHAR},
      seriel = #{record.seriel,jdbcType=CHAR},
      quantity = #{record.quantity,jdbcType=INTEGER},
      buy_unit = #{record.buyUnit,jdbcType=VARCHAR},
      origin_price = #{record.originPrice,jdbcType=REAL},
      real_price = #{record.realPrice,jdbcType=REAL}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.huatuo.clinics.cms.db.bean.TaPhaDispensingDtl" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    update ta_pha_dispensing_dtl
    <set >
      <if test="phaDrugId != null" >
        pha_drug_id = #{phaDrugId,jdbcType=CHAR},
      </if>
      <if test="dispenseId != null" >
        dispense_id = #{dispenseId,jdbcType=CHAR},
      </if>
      <if test="ordDtlId != null" >
        ord_dtl_id = #{ordDtlId,jdbcType=CHAR},
      </if>
      <if test="drugSpec != null" >
        drug_spec = #{drugSpec,jdbcType=VARCHAR},
      </if>
      <if test="tradeName != null" >
        trade_name = #{tradeName,jdbcType=VARCHAR},
      </if>
      <if test="manufacturer != null" >
        manufacturer = #{manufacturer,jdbcType=VARCHAR},
      </if>
      <if test="instockBatch != null" >
        instock_batch = #{instockBatch,jdbcType=VARCHAR},
      </if>
      <if test="orgId != null" >
        org_id = #{orgId,jdbcType=CHAR},
      </if>
      <if test="orderId != null" >
        order_id = #{orderId,jdbcType=CHAR},
      </if>
      <if test="chargeDtlId != null" >
        charge_dtl_id = #{chargeDtlId,jdbcType=CHAR},
      </if>
      <if test="seriel != null" >
        seriel = #{seriel,jdbcType=CHAR},
      </if>
      <if test="quantity != null" >
        quantity = #{quantity,jdbcType=INTEGER},
      </if>
      <if test="buyUnit != null" >
        buy_unit = #{buyUnit,jdbcType=VARCHAR},
      </if>
      <if test="originPrice != null" >
        origin_price = #{originPrice,jdbcType=REAL},
      </if>
      <if test="realPrice != null" >
        real_price = #{realPrice,jdbcType=REAL},
      </if>
    </set>
    where dispense_item_id = #{dispenseItemId,jdbcType=CHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.huatuo.clinics.cms.db.bean.TaPhaDispensingDtl" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 12 19:39:17 CST 2016.
    -->
    update ta_pha_dispensing_dtl
    set pha_drug_id = #{phaDrugId,jdbcType=CHAR},
      dispense_id = #{dispenseId,jdbcType=CHAR},
      ord_dtl_id = #{ordDtlId,jdbcType=CHAR},
      drug_spec = #{drugSpec,jdbcType=VARCHAR},
      trade_name = #{tradeName,jdbcType=VARCHAR},
      manufacturer = #{manufacturer,jdbcType=VARCHAR},
      instock_batch = #{instockBatch,jdbcType=VARCHAR},
      org_id = #{orgId,jdbcType=CHAR},
      order_id = #{orderId,jdbcType=CHAR},
      charge_dtl_id = #{chargeDtlId,jdbcType=CHAR},
      seriel = #{seriel,jdbcType=CHAR},
      quantity = #{quantity,jdbcType=INTEGER},
      buy_unit = #{buyUnit,jdbcType=VARCHAR},
      origin_price = #{originPrice,jdbcType=REAL},
      real_price = #{realPrice,jdbcType=REAL}
    where dispense_item_id = #{dispenseItemId,jdbcType=CHAR}
  </update>
  
  <select id="getDtlListByPId" parameterType="java.lang.String" resultMap="BaseResultMap">
	  	SELECT dispense_item_id, pha_drug_id, dispense_id, ord_dtl_id, drug_spec, trade_name, manufacturer, 
    	instock_batch, org_id, order_id, charge_dtl_id, seriel, SUM(quantity) quantity, buy_unit, origin_price, 
    	real_price 
    	FROM ta_pha_dispensing_dtl 
		WHERE dispense_id = #{dispenseId}
		and quantity &gt;= 0
		GROUP BY pha_drug_id
  </select>
  <!-- 拿取一个药品未发药的大规格总数量 -->
  <select id="getMaxActualQuantity" parameterType="map" resultType="java.lang.Integer">
	 SELECT SUM(d.quantity) FROM ta_pha_dispensing_dtl d 
		JOIN ta_pha_dispensing p ON (d.dispense_id = p.dispense_id)
		WHERE d.pha_drug_id = #{phaDrugId}
		AND d.org_id = #{orgId}
		AND d.seriel = '1'
		AND p.dispense_status = '0'
  </select>
  <!-- 拿取一个药品未发药的小规格总数量 -->
  <select id="getMinActualQuantity" parameterType="map" resultType="java.lang.Integer">
	  SELECT SUM(d.quantity) FROM ta_pha_dispensing_dtl d 
		JOIN ta_pha_dispensing p ON (d.dispense_id = p.dispense_id)
		WHERE d.pha_drug_id = #{phaDrugId}
		AND d.org_id = #{orgId}
		AND d.seriel = '2'
		AND p.dispense_status = '0'
  </select>
  <select id="getDtlListByPIdForBack" parameterType="java.lang.String" resultMap="BaseResultMap">
	  	SELECT * FROM ta_pha_dispensing_dtl 
		WHERE dispense_id = #{dispenseId}
  </select>

</mapper>